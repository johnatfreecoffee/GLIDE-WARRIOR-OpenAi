<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Glide Warrior HD Pixel Edition</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
  <script src="sprites.js"></script>
  <style>
    html,body { margin:0; background:#000; overflow:hidden; }
    canvas { border:3px solid #0f6; display:block; margin:auto; image-rendering: pixelated; }
  </style>
</head>
<body>
<script>
/* ----------- Globals ----------- */
let player, enemies=[], bullets=[], particles=[], powerups=[];
let platforms=[], tileset;
let cameraX=0, shake=0;
let score=0, highScore=0, gameState="loading";
let currentLevel=1;
let spawnTimer=0, gameTime=0;
const VIEW_W=960, VIEW_H=540;

/* ----------- Assets ----------- */
let spriteSheet, tileSheet;
let sfx={}, music;
function preload(){
  spriteSheet = loadImage("assets/sprites.png");
  tileSheet   = loadImage("assets/tiles.png");

  sfx.jump = loadSound("assets/jump.wav");
  sfx.shoot = loadSound("assets/shoot.wav");
  sfx.hit = loadSound("assets/hit.wav");
  sfx.explosion = loadSound("assets/explosion.wav");
  sfx.powerup = loadSound("assets/powerup.wav");
  music = loadSound("assets/music.mp3");
}

function setup(){
  createCanvas(VIEW_W, VIEW_H);
  pixelDensity(1);
  frameRate(60);
  initLevel(currentLevel);
  gameState="playing";
  if (music && !music.isPlaying()){ music.loop(); }
}

function initLevel(n){
  enemies=[]; bullets=[]; powerups=[]; particles=[];
  score=0; gameTime=0; cameraX=0;
  spawnTimer=0;
  // Player init
  player=createPlayer(100,VIEW_H-128);
  // Platforms from levels.json (placeholder here)
  platforms=[
    {x:0,y:VIEW_H-64,w:2000,h:64,type:"ground"}
  ];
}

function draw(){
  if (gameState==="loading") { background(0); fill(255); text("Loading...",20,20); return; }

  gameTime++;
  // Camera follow
  cameraX=lerp(cameraX, player.x-VIEW_W/3,0.1);

  push(); translate(-cameraX,0);
  drawBackground();

  // Platforms
  for (let p of platforms) drawTilePlatform(p);

  // Entities
  updatePlayer(); drawPlayer();
  for (let e of enemies){ updateEnemy(e); drawEnemy(e); }
  for (let b of bullets){ updateBullet(b); drawBullet(b); }
  for (let p of powerups){ updatePowerup(p); drawPowerup(p); }
  for (let pt of particles){ updateParticle(pt); drawParticle(pt); }

  pop();

  drawHUD();
}
</script>
</body>
</html>
